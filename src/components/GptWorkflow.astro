---
import Attributes from './workflow/Attributes.astro';
import PlaceholderFrame from './workflow/PlaceholderFrame.astro';
import Prompts from './workflow/Prompts.astro';
import Section from './workflow/Section.astro';
import Settings from './workflow/Settings.astro';
import SidebarDesktop from './workflow/SidebarDesktop.astro';
import SidebarDesktopContainer from './workflow/SidebarDesktopContainer.astro';
import SidebarMobile from './workflow/SidebarMobile.astro';
import SidebarMobileContainer from './workflow/SidebarMobileContainer.astro';
import TopBar from './workflow/TopBar.astro';
import WorkflowStats from './workflow/WorkflowStats.astro';

const { gpt } = Astro.props;
const settingsArray = Object.entries(gpt.settings).map(([name, value]) => ({ name, value }));
const currentStep = 3;
---
<div x-data="{ open: false, currentComponent: 'Research', activeMenuItem: 'sections' }" @menu-click.window="currentComponent = $event.detail" @keydown.window.escape="open = false">
  <SidebarMobileContainer>
    <SidebarMobile sections={gpt.sections} @click="currentComponent = $event.detail" />
  </SidebarMobileContainer>

  <SidebarDesktopContainer>
    <SidebarDesktop sections={gpt.sections} @click="currentComponent = $event.detail" />
  </SidebarDesktopContainer>

  <div class="lg:pl-72">
    <TopBar />

    <main class="py-10">
      <div class="px-4 sm:px-6 lg:px-8">
        <div x-show="currentComponent === 'overview'">
          <WorkflowStats workflow={gpt} />
        </div>
        <div x-show="currentComponent === 'attributes'">
          <Attributes attributes={gpt.attributes} />
        </div>
        <div x-show="currentComponent === 'prompts'">
          <Prompts prompts={gpt.prompts} />
        </div>
        <div x-show="currentComponent === 'settings'">
          <Settings settings={settingsArray} />
        </div>
        {gpt.sections.map((section) => (
          <div x-show={`currentComponent === '${section.name}'`} key={section.name}>
            <Section section={section} currentStep={currentStep} />
          </div>
        ))}
        <PlaceholderFrame>
          <h2 class="text-2xl font-semibold mb-4">Current Component: <span x-text="currentComponent"></span></h2>
        </PlaceholderFrame>
      </div>
    </main>
  </div>
</div>
